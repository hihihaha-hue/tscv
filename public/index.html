<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thแปฃ Sฤn Cแป Vแบญt</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <button id="music-toggle-btn">๐ต</button>
    <audio id="background-music" src="/assets/sounds/background.mp3" loop></audio>
    <button id="rulebook-btn">?</button>
    <button id="history-log-btn">๐</button>

    <div class="container">
        <!-- MรN HรNH CHรNH -->
        <div id="home-screen">
            <h1>Thแปฃ Sฤn Cแป Vแบญt</h1>
            <input type="text" id="player-name-input" placeholder="NHแบฌP TรN THแปข SฤN..." maxlength="15">
            <button id="create-room-btn">Mแป Cuแปc Thรกm Hiแปm Mแปi</button>
            <hr>
            <input type="text" id="room-code-input" placeholder="NHแบฌP Mร ฤOรN..." maxlength="4" style="text-transform:uppercase">
            <button id="join-room-btn">Tham Gia ฤoรn</button>
        </div>

        <!-- MรN HรNH PHรNG CHแป -->
        <div id="room-screen" style="display: none;">
            <h2>ฤoรn Thรกm Hiแปm: <span id="room-code-display"></span></h2>
            <ul id="player-list"></ul>
            <div id="host-controls" class="controls-wrapper"><button id="add-bot-btn">Thรชm AI</button><button id="start-game-btn" disabled>Bแบฏt ฤแบงu</button></div>
            <div id="player-controls" class="controls-wrapper"><button id="ready-btn">Sแบตn Sรng</button></div>
        </div>

        <!-- MรN HรNH CHฦI GAME -->
       <div id="game-screen" style="display: none;">
            <!-- CแปT TRรI: Dรnh cho chat hoแบทc thรดng tin phแปฅ -->
            <div id="left-column">
                <div id="role-display" class="game-panel">
                    <!-- Nแปi dung vai trรฒ sแบฝ ฤฦฐแปฃc JS chรจn vรo ฤรขy -->
                </div>
                <div id="artifact-display" class="game-panel" style="display: none;">
                    <h4>Cแป Vแบญt Cแปงa Bแบกn:</h4>
                    <div id="artifact-info" style="display: none;">
                        <strong id="artifact-name"></strong>
                        <p id="artifact-description"></p>
                        <button id="use-artifact-btn" style="display: none;">Kรญch hoแบกt</button>
                    </div>
                    <p id="no-artifact-message">Bแบกn chฦฐa cรณ cแป vแบญt nรo.</p>
                </div>
                <div id="chat-container" class="game-panel">
                    <div id="chat-messages"></div>
                    <div id="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Nhแบญp tin nhแบฏn..." maxlength="200">
                        <button id="send-chat-btn">Gแปญi</button>
                    </div>
                </div>
            </div>

            <!-- CแปT GIแปฎA: Khu vแปฑc chรญnh hiแปn thแป ngฦฐแปi chฦกi vร giai ฤoแบกn -->
            <div id="center-column">
                <div id="phase-info" class="game-panel">
                    <h2 id="phase-title"></h2>
                    <div id="timer-display"></div>
                </div>
                <div id="players-container" class="players-grid">
                    <!-- Cรกc avatar ngฦฐแปi chฦกi sแบฝ ฤฦฐแปฃc JS chรจn vรo ฤรขy -->
                </div>
            </div>

            <!-- CแปT PHแบขI: Bแบฃng xแบฟp hแบกng, Nรบt hรnh ฤแปng, vร Log game -->
           <div id="right-column">
            <div id="leaderboard" class="game-panel">
                <h3>Bแบฃng Xแบฟp Hแบกng</h3>
                <ul id="leaderboard-list"></ul>
            </div>
            
            <div id="roles-in-game" class="game-panel scrollable-panel">
                <h4>Cรกc Vai Trรฒ Trong Ngรy:</h4>
                <ul id="roles-in-game-list">
                    <!-- JS sแบฝ ฤiแปn cรกc vai trรฒ cแปงa vรกn ฤแบฅu vรo ฤรขy -->
                </ul>
            </div>
            
            <div id="action-container" class="game-panel">
                    <p id="phase-description"></p>
                    <div id="choice-buttons-container" class="action-buttons-grid" style="display: none;">
                        <button class="choice-buttons loyal" data-action="Giแบฃi Mรฃ">๐ Giแบฃi Mรฃ</button>
                        <button class="choice-buttons corrupt" data-action="Phรก Hoแบกi">๐ฃ Phรก Hoแบกi</button>
                        <button class="choice-buttons blank" data-action="Quan Sรกt">๐๏ธ Quan Sรกt</button>
                    </div>
                    <button id="skip-coordination-btn" class="skip-button" style="display: none;">Hรnh ฤแปng mแปt mรฌnh</button>
                    <button id="next-day-btn" class="next-day-btn" style="display: none;">Bแบฏt ฤแบงu Ngรy Tiแบฟp Theo</button>
                </div>
                <div id="message-area" class="game-panel">
                     <!-- Log game sแบฝ ฤฦฐแปฃc JS chรจn vรo ฤรขy -->
                </div>
            </div>
        </div>
    </div>

    <!-- OVERLAY HOรNG HรN -->
    <div id="twilight-overlay" style="display: none;">
        <div id="twilight-meeting-ui">
            <div class="twilight-header">
                <h2>Hoรng Hรดn - Vแบกch Trแบงn</h2>
                <button id="twilight-close-btn" class="close-btn">ร</button>
            </div>
            <ul id="twilight-player-list"></ul>
            <div class="twilight-footer">
                <button id="twilight-rest-btn" class="skip-button">Nghแป Ngฦกi</button>
            </div>
        </div>
    </div>

    <!-- OVERLAY CHUYแปN CแบขNH -->
    <div id="night-transition-overlay"><h2 id="night-transition-text"></h2></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/network.js"></script>
    <script src="/client.js"></script>

    <!-- ======================================================= -->
    <!-- SแปฌA LแปI: Thay thแบฟ <script> bแบฑng <template> -->
    <!-- ======================================================= -->
    <template id="rulebook-template">
        <div class="rulebook-container">
            <h2 class="rulebook-title">Di Cแบฃo Cแปงa Ngรดi ฤแปn</h2>
            
            <div class="rulebook-tabs">
                <button class="rulebook-tab active" data-target="page-foundation">Nแปn Tแบฃng</button>
                <button class="rulebook-tab" data-target="page-mechanics">Cฦก Chแบฟ</button>
                <button class="rulebook-tab" data-target="page-scoring">Phรกn Quyแบฟt</button>
                <button class="rulebook-tab" data-target="page-roles-overview">Tแปng Quan Vai Trรฒ</button>
                <button class="rulebook-tab" data-target="page-decrees-overview">Tแปng Quan Tiแบฟng Vแปng</button>
            </div>

            <div class="rulebook-pages">
                <!-- Trang 1: Nแปn Tแบฃng -->
                <div id="page-foundation" class="rulebook-page active" style="text-align: left; line-height: 1.7;">
                    <h3>Mแปฅc ฤรญch & Nแปn Tแบฃng</h3>
                    <p><i>"Nฦกi ฤรขy khรดng tแปn tแบกi thiแปn รกc, chแป cรณ tham vแปng. Ngฦฐฦกi khรดng thuแปc vแป mแปt phe phรกi nรo; ngฦฐฦกi lร mแปt cรก nhรขn theo ฤuแปi mแปฅc ฤรญch cแปงa riรชng mรฌnh."</i></p>
                    
                    <h4>Hai Con ฤฦฐแปng Dแบซn ฤแบฟn Vinh Quang:</h4>
                    <ul>
                        <li><strong>Thแบฏng Bแบฑng Tiแบฟn ฤแป:</strong> Tรญch lลฉy ฤแปง sแป ฤiแปm Tiแบฟn ฤแป mร ngรดi ฤแปn yรชu cแบงu (15, 20, hoแบทc 25). ฤรขy lร con ฤฦฐแปng cแปงa kแบป mแบกnh.</li>
                        <li><strong>Thแบฏng Bแบฑng Thiรชn Mแปnh:</strong> Hoรn thรnh ฤiแปu kiแปn thแบฏng lแปฃi bรญ mแบญt cแปงa Vai Trรฒ mร ngฦฐฦกi ฤang nแบฏm giแปฏ. ฤรขy lร con ฤฦฐแปng cแปงa nhแปฏng kแบป mฦฐu lฦฐแปฃc.</li>
                    </ul>
                    <p><strong>Thแบฅt Bแบกi:</strong> Nแบฟu Tiแบฟn ฤแป cแปงa ngฦฐฦกi rฦกi xuแปng mแปc รขm ฤแปi nghแปch (-15, -20, hoแบทc -25), linh hแปn ngฦฐฦกi sแบฝ bแป ngรดi ฤแปn nuแปt chแปญng.</p>
                    <hr>
                    <h4>Diแปn Biแบฟn Mแปt Ngรy:</h4>
                    <ol>
                        <li><strong>Sรกng (Thรกm Hiแปm):</strong> Bรญ mแบญt chแปn Hรnh ฤแปng. Cรณ thแป ฤแป nghแป Phแปi Hแปฃp.</li>
                        <li><strong>Trฦฐa (Tiแบฟng Vแปng):</strong> Ngรดi ฤแปn ban bแป mแปt luแบญt lแป ฤแบทc biแปt cho ngรy hรดm ฤรณ.</li>
                        <li><strong>Hoรng Hรดn (Tแบญp Trung):</strong> Mแบทt ฤแปi mแบทt. ฤรขy lร lรบc ฤแป Vแบกch Trแบงn kแบป khรกc.</li>
                        <li><strong>ฤรชm (Phรกn Xรฉt):</strong> Ngรดi ฤแปn quyแบฟt toรกn ฤiแปm sแป.</li>
                    </ol>
                </div>

                <!-- Trang 2: Cฦก Chแบฟ Mแบฅu Chแปt -->
                <div id="page-mechanics" class="rulebook-page" style="text-align: left; line-height: 1.7;">
                    <h3>Cฦก Chแบฟ Mแบฅu Chแปt</h3>
                    <h4>Hรnh ฤแปng Bรญ Mแบญt:</h4>
                    <p>Vรo buแปi sรกng, ngฦฐฦกi phแบฃi chแปn 1 trong 3 hรnh ฤแปng:</p>
                    <ul>
                        <li><strong>๐ Giแบฃi Mรฃ:</strong> Cแป gแบฏng giรnh chiแบฟn thแบฏng bแบฑng sแปฑ khรดn khรฉo.</li>
                        <li><strong>๐ฃ Phรก Hoแบกi:</strong> Cแป gแบฏng giรnh chiแบฟn thแบฏng bแบฑng sแปฑ hแปn loแบกn.</li>
                        <li><strong>๐๏ธ Quan Sรกt:</strong> ฤแปฉng ngoรi cuแปc, chแป ฤแปฃi thแปi cฦก.</li>
                    </ul>

                    <h4>๐ค Phแปi Hแปฃp:</h4>
                    <p>Mแปt hรnh ฤแปng chiแบฟn thuแบญt cao, thแปฑc hiแปn trong Giai ฤoแบกn Thรกm Hiแปm. Ngฦฐฦกi chแปn mแปt ngฦฐแปi chฦกi khรกc:</p>
                    <ul>
                        <li><strong>Thรnh cรดng:</strong> Nแบฟu hai ngฦฐแปi cรณ cรนng hรnh ฤแปng (cรนng ๐, ๐ฃ, hoแบทc ๐๏ธ), cแบฃ hai sแบฝ ฤฦฐแปฃc gแปp lแบกi thรnh mแปt "Nhรณm", chแป tรญnh lร <strong>mแปt phiแบฟu duy nhแบฅt</strong> vรo cuแปi ngรy.</li>
                        <li><strong>Thแบฅt bแบกi:</strong> Nแบฟu khรกc hรnh ฤแปng, ngฦฐฦกi (ngฦฐแปi chแปง ฤแปng) bแป <strong>-1 ฤiแปm</strong>.</li>
                    </ul>
                    <p><i>"Nhiแปu nhรณm nhแป cรณ thแป ฤฦฐแปฃc nแปi lแบกi thรnh mแปt liรชn minh lแปn nแบฟu cรณ chung thรnh viรชn."</i></p>

                    <h4>๐ฅ Vแบกch Trแบงn:</h4>
                    <p>Hรnh ฤแปng chรญnh trong Giแป Hoรng Hรดn. Ngฦฐฦกi chแปn mแปt mแปฅc tiรชu vร ฤoรกn hรnh ฤแปng bรญ mแบญt cแปงa hแป:</p>
                    <ul>
                        <li><strong>ฤoรกn ฤรบng:</strong> Ngฦฐฦกi <strong>+2 ฤiแปm</strong>, mแปฅc tiรชu <strong>-2 ฤiแปm</strong>.</li>
                        <li><strong>ฤoรกn Sai:</strong> Ngฦฐฦกi <strong>-2 ฤiแปm</strong>, mแปฅc tiรชu <strong>+2 ฤiแปm</strong>. (Nhร Tiรชn Tri chแป bแป -1).</li>
                    </ul>
                </div>

                <!-- Trang 3: Phรกn Quyแบฟt ฤiแปm -->
                <div id="page-scoring" class="rulebook-page" style="text-align: left; line-height: 1.7;">
                    <h3>Phรกn Quyแบฟt ฤiแปm Chi Tiแบฟt</h3>
                    <h4>Khi Cรณ Phe Thแบฏng/Thua:</h4>
                    <p>Phe cรณ <strong>รญt phiแบฟu hฦกn</strong> sแบฝ thแบฏng (trแปซ khi cรณ Phรกn Xรฉt ฤแบฃo Ngฦฐแปฃc).</p>
                    <ul>
                        <li>Ngฦฐแปi thuแปc phe thแบฏng: <strong>+2 ฤiแปm</strong>.</li>
                        <li>Ngฦฐแปi thuแปc phe thua: <strong>-1 ฤiแปm</strong>.</li>
                    </ul>
                    <p><strong>Sแป phแบญn Kแบป Quan Sรกt (๐๏ธ):</strong></p>
                    <ul>
                        <li>Nแบฟu sแป phiแบฟu ๐๏ธ <strong>รญt hฦกn</strong> mแปt nแปญa sแป ngฦฐแปi chฦกi, hแป theo phe thแบฏng vร nhแบญn <strong>+3 ฤiแปm</strong>.</li>
                        <li>Nแบฟu sแป phiแบฟu ๐๏ธ <strong>nhiแปu hฦกn hoแบทc bแบฑng</strong> mแปt nแปญa, hแป bแป <strong>-1 ฤiแปm</strong> vร <strong>phe thแบฏng</strong> ฤฦฐแปฃc <strong>+1 ฤiแปm</strong> nแปฏa.</li>
                    </ul>

                    <h4>Khi Kแบฟt Quแบฃ Lร HรA:</h4>
                    <ul>
                        <li><strong>Nแบฟu khรดng cรณ phiแบฟu ๐๏ธ:</strong> Tแบฅt cแบฃ ngฦฐแปi chฦกi <strong>-1 ฤiแปm</strong>.</li>
                        <li><strong>Nแบฟu cรณ รญt phiแบฟu ๐๏ธ:</strong> Ngฦฐแปi chแปn ๐/๐ฃ <strong>-1 ฤiแปm</strong>. Ngฦฐแปi chแปn ๐๏ธ ฤฦฐแปฃc an toรn (0 ฤiแปm).</li>
                        <li><strong>Nแบฟu cรณ nhiแปu phiแบฟu ๐๏ธ:</strong> Ngฦฐแปi chแปn ๐๏ธ <strong>-1 ฤiแปm</strong>. Ngฦฐแปi chแปn ๐/๐ฃ ฤฦฐแปฃc <strong>+1 ฤiแปm</strong>.</li>
                    </ul>
                </div>
                
                <!-- Trang 4: Liแปt kรช tแบฅt cแบฃ vai trรฒ -->
                <div id="page-roles-overview" class="rulebook-page scrollable-page" style="text-align: left; line-height: 1.6;">
                    <h3>Tแปng Quan Cรกc Linh Hแปn</h3>
                    <p><i>"ฤรขy lร danh sรกch tแบฅt cแบฃ nhแปฏng linh hแปn cแป xฦฐa cรณ thแป vang vแปng trong ngรดi ฤแปn. Hรฃy nghiรชn cแปฉu kแปน, vรฌ ngฦฐฦกi khรดng biแบฟt sแบฝ phแบฃi ฤแปi mแบทt vแปi ai..."</i></p>
                    <div id="all-roles-list-container">
                        <!-- JS sแบฝ tแปฑ ฤแปng ฤiแปn danh sรกch vai trรฒ vรo ฤรขy -->
                    </div>
                </div>
                
                <!-- Trang 5: Liแปt kรช tแบฅt cแบฃ Tiแบฟng Vแปng -->
                <div id="page-decrees-overview" class="rulebook-page scrollable-page" style="text-align: left; line-height: 1.6;">
                    <h3>Tแปng Quan Cรกc Tiแบฟng Vแปng</h3>
                    <p><i>"Ngรดi ฤแปn cรณ thแป bแบป cong thแปฑc tแบกi bแบฑng nhแปฏng luแบญt lแป cแป xฦฐa nรy. Hรฃy chuแบฉn bแป cho mแปi khแบฃ nฤng."</i></p>
                    <div id="all-decrees-list-container">
                         <!-- JS sแบฝ tแปฑ ฤแปng ฤiแปn danh sรกch Tiแบฟng Vแปng vรo ฤรขy -->
                    </div>
                </div>
            </div>
        </div>
    </template>
</body>
</html>