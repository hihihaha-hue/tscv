<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª£ SƒÉn C·ªï V·∫≠t</title>
    
    <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png">
    
    <!-- [FIX] Thay th·∫ø ph√¥ng ch·ªØ ƒë·ªÉ h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß ti·∫øng Vi·ªát -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/style.css">
</head>
<script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
<body>
    <button id="music-toggle-btn">üéµ</button>
    
    <audio id="background-music" src="/assets/sounds/background.mp3" loop></audio>
    
   <button id="rulebook-btn" title="ƒêang t·∫£i d·ªØ li·ªáu..." disabled>?</button>
   <button id="history-log-btn">üìú</button>

    <div class="container">
        <!-- M√ÄN H√åNH CH√çNH -->
        <div id="home-screen">
            <h1>Th·ª£ SƒÉn C·ªï V·∫≠t</h1>
            <input type="text" id="player-name-input" placeholder="NH·∫¨P T√äN TH·ª¢ SƒÇN..." maxlength="15">
            <button id="create-room-btn">M·ªü Cu·ªôc Th√°m Hi·ªÉm M·ªõi</button>
            <hr>
            <input type="text" id="room-code-input" placeholder="NH·∫¨P M√É ƒêO√ÄN..." maxlength="4" style="text-transform:uppercase">
            <button id="join-room-btn">Tham Gia ƒêo√†n</button>
        </div>

        <!-- M√ÄN H√åNH PH√íNG CH·ªú -->
        <div id="room-screen" style="display: none;">
            <h2>ƒêo√†n Th√°m Hi·ªÉm: <span id="room-code-display"></span></h2>
            <ul id="player-list"></ul>
            <div id="host-controls" class="controls-wrapper"><button id="add-bot-btn">Th√™m AI</button><button id="start-game-btn" disabled>B·∫Øt ƒê·∫ßu</button></div>
            <div id="player-controls" class="controls-wrapper"><button id="ready-btn">S·∫µn S√†ng</button></div>
        </div>

        <!-- M√ÄN H√åNH CH∆†I GAME -->
       <div id="game-screen" style="display: none;">
    <!-- C·ªòT TR√ÅI: Gi·ªØ nguy√™n kh√¥ng ƒë·ªïi -->
    <div id="left-column">
        <div id="role-display" class="game-panel">
            <!-- N·ªôi dung vai tr√≤ s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
        </div>
        <div id="artifact-display" class="game-panel" style="display: none;">
            <h4>C·ªï V·∫≠t C·ªßa B·∫°n:</h4>
            <div id="artifact-info" style="display: none;">
                <strong id="artifact-name"></strong>
                <p id="artifact-description"></p>
                <button id="use-artifact-btn" style="display: none;">K√≠ch ho·∫°t</button>
            </div>
            <p id="no-artifact-message">B·∫°n ch∆∞a c√≥ c·ªï v·∫≠t n√†o.</p>
        </div>
        <div id="chat-container" class="game-panel">
            <div id="chat-messages"></div>
            <div id="chat-input-area">
                <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." maxlength="200">
                <button id="send-chat-btn">G·ª≠i</button>
            </div>
        </div>
    </div>

    <!-- [LAYOUT RESTRUCTURE] C·ªòT GI·ªÆA: B·∫£ng th√¥ng b√°o, Ng∆∞·ªùi ch∆°i, v√† H√†nh ƒë·ªông -->
    <div id="center-column">
        <!-- B·∫£ng th√¥ng b√°o s·ª± ki·ªán (log game) ƒë∆∞·ª£c chuy·ªÉn l√™n ƒë√¢y -->
        <div id="message-area" class="game-panel">
             <!-- Log game s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
        </div>
        
        <!-- Khu v·ª±c hi·ªÉn th·ªã ng∆∞·ªùi ch∆°i -->
        <div id="players-container" class="players-grid game-panel">
            <!-- C√°c avatar ng∆∞·ªùi ch∆°i s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
        </div>
        
        <!-- Khu v·ª±c h√†nh ƒë·ªông ƒë∆∞·ª£c chuy·ªÉn xu·ªëng d∆∞·ªõi c√πng -->
        <div id="action-container" class="game-panel">
            <p id="phase-description"></p>
            <div id="choice-buttons-container" class="action-buttons-grid" style="display: none;">
                <button class="choice-buttons loyal" data-action="Gi·∫£i M√£">üìú Gi·∫£i M√£</button>
                <button class="choice-buttons corrupt" data-action="Ph√° Ho·∫°i">üí£ Ph√° Ho·∫°i</button>
                <button class="choice-buttons blank" data-action="Quan S√°t">üëÅÔ∏è Quan S√°t</button>
            </div>
            <button id="skip-coordination-btn" class="skip-button" style="display: none;">H√†nh ƒë·ªông m·ªôt m√¨nh</button>
            <button id="open-twilight-btn" style="display: none;">M·ªü B·∫£ng V·∫°ch Tr·∫ßn</button>
            <button id="next-day-btn" class="next-day-btn" style="display: none;">B·∫Øt ƒê·∫ßu Ng√†y Ti·∫øp Theo</button>
        </div>
    </div>

    <!-- [LAYOUT RESTRUCTURE] C·ªòT PH·∫¢I: B·∫£ng x·∫øp h·∫°ng, Vai tr√≤, v√† Th√¥ng tin Giai ƒëo·∫°n -->
    <div id="right-column">
        <div id="leaderboard" class="game-panel">
            <h3>B·∫£ng X·∫øp H·∫°ng</h3>
            <ul id="leaderboard-list"></ul>
        </div>
        
        <div id="roles-in-game" class="game-panel scrollable-panel">
            <h4>C√°c Vai Tr√≤ Trong Ng√†y:</h4>
            <ul id="roles-in-game-list">
                <!-- JS s·∫Ω ƒëi·ªÅn c√°c vai tr√≤ c·ªßa v√°n ƒë·∫•u v√†o ƒë√¢y -->
            </ul>
        </div>
        
        <!-- Th√¥ng tin giai ƒëo·∫°n ƒë∆∞·ª£c chuy·ªÉn xu·ªëng ƒë√¢y -->
        <div id="phase-info" class="game-panel">
            <h2 id="phase-title"></h2>
            <div id="timer-display"></div>
        </div>
    </div>
</div>

    <!-- OVERLAY HO√ÄNG H√îN -->
    <div id="twilight-overlay" style="display: none;">
        <div id="twilight-meeting-ui">
            <div class="twilight-header">
                <h2>Ho√†ng H√¥n - V·∫°ch Tr·∫ßn</h2>
                <button id="twilight-close-btn" class="close-btn">√ó</button>
            </div>
            <ul id="twilight-player-list"></ul>
            <div class="twilight-footer">
                <button id="twilight-rest-btn" class="skip-button">Ngh·ªâ Ng∆°i</button>
            </div>
        </div>
    </div>

    <!-- [BUG FIX] OVERLAY CHUY·ªÇN C·∫¢NH -->
    <div id="night-transition-overlay"><h2 id="night-transition-text"></h2></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/network.js"></script>
    <script src="/client.js"></script>

  <!-- [UPGRADE] S·ª≠ d·ª•ng template ƒë·ªÉ t√°ch HTML ra kh·ªèi JS, gi√∫p m√£ d·ªÖ b·∫£o tr√¨ h∆°n -->
  <template id="rulebook-template">
    <div class="rulebook-container">
        <h2 class="rulebook-title">Di C·∫£o C·ªßa Ng√¥i ƒê·ªÅn</h2>
        <div class="rulebook-tabs">
            <button class="rulebook-tab active" data-target="page-foundation">N·ªÅn T·∫£ng</button>
            <button class="rulebook-tab" data-target="page-mechanics">C∆° Ch·∫ø</button>
            <button class="rulebook-tab" data-target="page-scoring">Ph√°n Quy·∫øt</button>
            <button class="rulebook-tab" data-target="page-artifacts">C·ªï V·∫≠t</button>
            <button class="rulebook-tab" data-target="page-roles-overview">Vai Tr√≤</button>
            <button class="rulebook-tab" data-target="page-decrees-overview">Ti·∫øng V·ªçng</button>
        </div>
        <div class="rulebook-pages">
            <!-- Page 1: Foundation -->
            <div id="page-foundation" class="rulebook-page active" style="text-align: left; line-height: 1.7;">
                <h3>M·ª•c ƒê√≠ch & N·ªÅn T·∫£ng</h3>
                <p><i>"N∆°i ƒë√¢y kh√¥ng t·ªìn t·∫°i thi·ªán √°c, ch·ªâ c√≥ tham v·ªçng. Ng∆∞∆°i kh√¥ng thu·ªôc v·ªÅ m·ªôt phe ph√°i n√†o; ng∆∞∆°i l√† m·ªôt c√° nh√¢n theo ƒëu·ªïi m·ª•c ƒë√≠ch c·ªßa ri√™ng m√¨nh."</i></p>
                <h4>Hai Con ƒê∆∞·ªùng D·∫´n ƒê·∫øn Vinh Quang:</h4>
                <ul>
                    <li><strong>Th·∫Øng B·∫±ng Ti·∫øn ƒê·ªô:</strong> T√≠ch l≈©y ƒë·ªß s·ªë ƒëi·ªÉm Ti·∫øn ƒê·ªô m√† ng√¥i ƒë·ªÅn y√™u c·∫ßu (15, 20, ho·∫∑c 25).</li>
                    <li><strong>Th·∫Øng B·∫±ng Thi√™n M·ªánh:</strong> Ho√†n th√†nh ƒëi·ªÅu ki·ªán th·∫Øng l·ª£i b√≠ m·∫≠t c·ªßa Vai Tr√≤ m√† ng∆∞∆°i ƒëang n·∫Øm gi·ªØ.</li>
                </ul>
                <p><strong>Th·∫•t B·∫°i:</strong> N·∫øu Ti·∫øn ƒê·ªô c·ªßa ng∆∞∆°i r∆°i xu·ªëng m·ªëc √¢m ƒë·ªëi ngh·ªãch (-15, -20, ho·∫∑c -25), linh h·ªìn ng∆∞∆°i s·∫Ω b·ªã ng√¥i ƒë·ªÅn nu·ªët ch·ª≠ng.</p>
            </div>
            <!-- Page 2: Mechanics -->
            <div id="page-mechanics" class="rulebook-page" style="text-align: left; line-height: 1.7;">
                <h3>H√†nh ƒê·ªông & T∆∞∆°ng T√°c</h3>
                <h4>H√†nh ƒê·ªông B√≠ M·∫≠t (Giai ƒêo·∫°n Th√°m Hi·ªÉm):</h4>
                <p>M·ªói bu·ªïi s√°ng, ng∆∞∆°i ph·∫£i ch·ªçn 1 trong 3 h√†nh ƒë·ªông. M·ªói h√†nh ƒë·ªông ƒë·ªÅu c√≥ r·ªßi ro v√† ph·∫ßn th∆∞·ªüng ri√™ng:</p>
                <ul>
                    <li><strong>üìú Gi·∫£i M√£:</strong> ƒê√≥ng g√≥p phi·∫øu v√†o phe "√Ånh S√°ng". 30% c∆° h·ªôi +1 Ti·∫øn ƒê·ªô, 10% c∆° h·ªôi t√¨m th·∫•y <strong>C·ªï V·∫≠t Th√°m Hi·ªÉm</strong>.</li>
                    <li><strong>üí£ Ph√° Ho·∫°i:</strong> ƒê√≥ng g√≥p phi·∫øu v√†o phe "H·ªón Lo·∫°n". 10% c∆° h·ªôi t√¨m th·∫•y <strong>C·ªï V·∫≠t H·ªón Lo·∫°n</strong>.</li>
                    <li><strong>üëÅÔ∏è Quan S√°t:</strong> ƒê·ª©ng ngo√†i cu·ªôc, ch·ªù ƒë·ª£i th·ªùi c∆°.</li>
                </ul>
                <h4>ü§ù Ph·ªëi H·ª£p:</h4>
                <p>ƒê·ªÅ ngh·ªã h·ª£p t√°c v·ªõi ng∆∞·ªùi kh√°c. N·∫øu th√†nh c√¥ng (c√πng h√†nh ƒë·ªông), phi·∫øu c·ªßa c·∫£ nh√≥m s·∫Ω ƒë∆∞·ª£c g·ªôp l·∫°i th√†nh m·ªôt.</p>
                <h4>üî• V·∫°ch Tr·∫ßn:</h4>
                <p>V√†o Ho√†ng H√¥n, ƒëo√°n h√†nh ƒë·ªông c·ªßa m·ª•c ti√™u: ƒê√∫ng (Ng∆∞∆°i +2, M·ª•c ti√™u -2), Sai (Ng∆∞∆°i -2, M·ª•c ti√™u +2).</p>
            </div>
            <!-- Page 3: Scoring -->
            <div id="page-scoring" class="rulebook-page" style="text-align: left; line-height: 1.7;">
                <h3>Ph√°n Quy·∫øt ƒêi·ªÉm Chi Ti·∫øt</h3>
                <p><i>"Ng√¥i ƒë·ªÅn ch·ªâ c√¥ng nh·∫≠n n·ªó l·ª±c c·ªßa phe c√≥ √≠t ng∆∞·ªùi h∆°n. S·ªë ƒë√¥ng th∆∞·ªùng d·∫´n ƒë·∫øn s·ª± t·ª± m√£n v√† th·∫•t b·∫°i."</i></p>
                <h4>Khi C√≥ Phe Th·∫Øng/Thua:</h4>
                <ul>
                    <li><strong>ƒêi·ªÅu ki·ªán:</strong> Phe c√≥ <strong>√≠t phi·∫øu h∆°n</strong> s·∫Ω th·∫Øng (Gi·∫£i M√£ vs Ph√° Ho·∫°i).</li>
                    <li>Ng∆∞·ªùi thu·ªôc phe th·∫Øng: <strong>+2 ƒëi·ªÉm</strong>.</li>
                    <li>Ng∆∞·ªùi thu·ªôc phe thua: <strong>-1 ƒëi·ªÉm</strong>.</li>
                </ul>
                <h4>S·ªë ph·∫≠n K·∫ª Quan S√°t (üëÅÔ∏è):</h4>
                <p>S·ªë ph·∫≠n c·ªßa h·ªç ph·ª• thu·ªôc v√†o vi·ªác s·ªë l∆∞·ª£ng phi·∫øu üëÅÔ∏è c√≥ ƒë·∫°t "Ng∆∞·ª°ng" hay kh√¥ng (Ng∆∞·ª°ng = S·ªë ng∆∞·ªùi ch∆°i / 2).</p>
                <ul>
                    <li><strong>N·∫øu c√≥ √≠t Quan S√°t (&lt; Ng∆∞·ª°ng):</strong> H·ªç theo phe th·∫Øng v√† nh·∫≠n <strong>+3 ƒëi·ªÉm</strong>.</li>
                    <li><strong>N·∫øu c√≥ nhi·ªÅu Quan S√°t (&gt;= Ng∆∞·ª°ng):</strong> H·ªç b·ªã <strong>-1 ƒëi·ªÉm</strong>, v√† phe th·∫Øng ƒë∆∞·ª£c th∆∞·ªüng th√™m <strong>+1 ƒëi·ªÉm</strong>.</li>
                </ul>
            </div>
            <!-- Page 4: Artifacts (Dynamically filled) -->
            <div id="page-artifacts" class="rulebook-page scrollable-page" style="text-align: left; line-height: 1.7;">
                <h3>C·ªï V·∫≠t B·ªã L√£ng Qu√™n</h3>
                <h4>C·ªï V·∫≠t Th√°m Hi·ªÉm (T·ª´ üìú Gi·∫£i M√£):</h4><div data-content-id="artifacts-tham-hiem"></div>
                <h4>C·ªï V·∫≠t H·ªón Lo·∫°n (T·ª´ üí£ Ph√° Ho·∫°i):</h4><div data-content-id="artifacts-hon-loan"></div>
            </div>
            <!-- Page 5: Roles (Dynamically filled) -->
            <div id="page-roles-overview" class="rulebook-page scrollable-page">
                <h3>T·ªïng Quan Vai Tr√≤</h3><div data-content-id="roles"></div>
            </div>
            <!-- Page 6: Decrees (Dynamically filled) -->
            <div id="page-decrees-overview" class="rulebook-page scrollable-page">
                <h3>T·ªïng Quan Ti·∫øng V·ªçng</h3><div data-content-id="decrees"></div>
            </div>
        </div>
    </div>
</template>
</body>
</html>