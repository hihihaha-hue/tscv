<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ª£ SƒÉn C·ªï V·∫≠t</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <button id="music-toggle-btn">üéµ</button>
    <audio id="background-music" src="/assets/sounds/background.mp3" loop></audio>
    <button id="rulebook-btn">?</button>
    <button id="history-log-btn">üìú</button>

    <div class="container">
        <!-- M√ÄN H√åNH CH√çNH -->
        <div id="home-screen">
            <h1>Th·ª£ SƒÉn C·ªï V·∫≠t</h1>
            <input type="text" id="player-name-input" placeholder="NH·∫¨P T√äN TH·ª¢ SƒÇN..." maxlength="15">
            <button id="create-room-btn">M·ªü Cu·ªôc Th√°m Hi·ªÉm M·ªõi</button>
            <hr>
            <input type="text" id="room-code-input" placeholder="NH·∫¨P M√É ƒêO√ÄN..." maxlength="4" style="text-transform:uppercase">
            <button id="join-room-btn">Tham Gia ƒêo√†n</button>
        </div>

        <!-- M√ÄN H√åNH PH√íNG CH·ªú -->
        <div id="room-screen" style="display: none;">
            <h2>ƒêo√†n Th√°m Hi·ªÉm: <span id="room-code-display"></span></h2>
            <ul id="player-list"></ul>
            <div id="host-controls" class="controls-wrapper"><button id="add-bot-btn">Th√™m AI</button><button id="start-game-btn" disabled>B·∫Øt ƒê·∫ßu</button></div>
            <div id="player-controls" class="controls-wrapper"><button id="ready-btn">S·∫µn S√†ng</button></div>
        </div>

        <!-- M√ÄN H√åNH CH∆†I GAME -->
       <div id="game-screen" style="display: none;">
            <!-- C·ªòT TR√ÅI: D√†nh cho chat ho·∫∑c th√¥ng tin ph·ª• -->
            <div id="left-column">
                <div id="role-display" class="game-panel">
                    <!-- N·ªôi dung vai tr√≤ s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
                </div>
                <div id="artifact-display" class="game-panel" style="display: none;">
                    <h4>C·ªï V·∫≠t C·ªßa B·∫°n:</h4>
                    <div id="artifact-info" style="display: none;">
                        <strong id="artifact-name"></strong>
                        <p id="artifact-description"></p>
                        <button id="use-artifact-btn" style="display: none;">K√≠ch ho·∫°t</button>
                    </div>
                    <p id="no-artifact-message">B·∫°n ch∆∞a c√≥ c·ªï v·∫≠t n√†o.</p>
                </div>
                <div id="chat-container" class="game-panel">
                    <div id="chat-messages"></div>
                    <div id="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." maxlength="200">
                        <button id="send-chat-btn">G·ª≠i</button>
                    </div>
                </div>
            </div>

            <!-- C·ªòT GI·ªÆA: Khu v·ª±c ch√≠nh hi·ªÉn th·ªã ng∆∞·ªùi ch∆°i v√† giai ƒëo·∫°n -->
            <div id="center-column">
                <div id="phase-info" class="game-panel">
                    <h2 id="phase-title"></h2>
                    <div id="timer-display"></div>
                </div>
                <div id="players-container" class="players-grid">
                    <!-- C√°c avatar ng∆∞·ªùi ch∆°i s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
                </div>
            </div>

            <!-- C·ªòT PH·∫¢I: B·∫£ng x·∫øp h·∫°ng, N√∫t h√†nh ƒë·ªông, v√† Log game -->
           <div id="right-column">
            <div id="leaderboard" class="game-panel">
                <h3>B·∫£ng X·∫øp H·∫°ng</h3>
                <ul id="leaderboard-list"></ul>
            </div>
            
            <div id="roles-in-game" class="game-panel scrollable-panel">
                <h4>C√°c Vai Tr√≤ Trong Ng√†y:</h4>
                <ul id="roles-in-game-list">
                    <!-- JS s·∫Ω ƒëi·ªÅn c√°c vai tr√≤ c·ªßa v√°n ƒë·∫•u v√†o ƒë√¢y -->
                </ul>
            </div>
            
            <div id="action-container" class="game-panel">
                    <p id="phase-description"></p>
                    <div id="choice-buttons-container" class="action-buttons-grid" style="display: none;">
                        <button class="choice-buttons loyal" data-action="Gi·∫£i M√£">üìú Gi·∫£i M√£</button>
                        <button class="choice-buttons corrupt" data-action="Ph√° Ho·∫°i">üí£ Ph√° Ho·∫°i</button>
                        <button class="choice-buttons blank" data-action="Quan S√°t">üëÅÔ∏è Quan S√°t</button>
                    </div>
                    <button id="skip-coordination-btn" class="skip-button" style="display: none;">H√†nh ƒë·ªông m·ªôt m√¨nh</button>
                    <button id="next-day-btn" class="next-day-btn" style="display: none;">B·∫Øt ƒê·∫ßu Ng√†y Ti·∫øp Theo</button>
                </div>
                <div id="message-area" class="game-panel">
                     <!-- Log game s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
                </div>
            </div>
        </div>
    </div>

    <!-- OVERLAY HO√ÄNG H√îN -->
    <div id="twilight-overlay" style="display: none;">
        <div id="twilight-meeting-ui">
            <div class="twilight-header">
                <h2>Ho√†ng H√¥n - V·∫°ch Tr·∫ßn</h2>
                <button id="twilight-close-btn" class="close-btn">√ó</button>
            </div>
            <ul id="twilight-player-list"></ul>
            <div class="twilight-footer">
                <button id="twilight-rest-btn" class="skip-button">Ngh·ªâ Ng∆°i</button>
            </div>
        </div>
    </div>

    <!-- OVERLAY CHUY·ªÇN C·∫¢NH -->
    <div id="night-transition-overlay"><h2 id="night-transition-text"></h2></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/network.js"></script>
    <script src="/client.js"></script>

    <!-- ======================================================= -->
    <!-- S·ª¨A L·ªñI: Thay th·∫ø <script> b·∫±ng <template> -->
    <!-- ======================================================= -->
  <template id="rulebook-template">
    <div class="rulebook-container">
        <h2 class="rulebook-title">Di C·∫£o C·ªßa Ng√¥i ƒê·ªÅn</h2>
        
        <div class="rulebook-tabs">
            <button class="rulebook-tab active" data-target="page-foundation">N·ªÅn T·∫£ng</button>
            <button class="rulebook-tab" data-target="page-mechanics">C∆° Ch·∫ø</button>
            <button class="rulebook-tab" data-target="page-scoring">Ph√°n Quy·∫øt</button>
            <button class="rulebook-tab" data-target="page-artifacts">C·ªï V·∫≠t</button> <!-- TH√äM TAB M·ªöI -->
            <button class="rulebook-tab" data-target="page-roles-overview">T·ªïng Quan Vai Tr√≤</button>
            <button class="rulebook-tab" data-target="page-decrees-overview">T·ªïng Quan Ti·∫øng V·ªçng</button>
        </div>

        <div class="rulebook-pages">
            <!-- Trang 1: N·ªÅn T·∫£ng (Gi·ªØ nguy√™n, b·∫°n c√≥ th·ªÉ gi·ªØ n·ªôi dung c≈© c·ªßa m√¨nh ·ªü ƒë√¢y) -->
            <div id="page-foundation" class="rulebook-page active" style="text-align: left; line-height: 1.7;">
                <h3>M·ª•c ƒê√≠ch & N·ªÅn T·∫£ng</h3>
                <p><i>"N∆°i ƒë√¢y kh√¥ng t·ªìn t·∫°i thi·ªán √°c, ch·ªâ c√≥ tham v·ªçng. Ng∆∞∆°i kh√¥ng thu·ªôc v·ªÅ m·ªôt phe ph√°i n√†o; ng∆∞∆°i l√† m·ªôt c√° nh√¢n theo ƒëu·ªïi m·ª•c ƒë√≠ch c·ªßa ri√™ng m√¨nh."</i></p>
                
                <h4>Hai Con ƒê∆∞·ªùng D·∫´n ƒê·∫øn Vinh Quang:</h4>
                <ul>
                    <li><strong>Th·∫Øng B·∫±ng Ti·∫øn ƒê·ªô:</strong> T√≠ch l≈©y ƒë·ªß s·ªë ƒëi·ªÉm Ti·∫øn ƒê·ªô m√† ng√¥i ƒë·ªÅn y√™u c·∫ßu (15, 20, ho·∫∑c 25).</li>
                    <li><strong>Th·∫Øng B·∫±ng Thi√™n M·ªánh:</strong> Ho√†n th√†nh ƒëi·ªÅu ki·ªán th·∫Øng l·ª£i b√≠ m·∫≠t c·ªßa Vai Tr√≤ m√† ng∆∞∆°i ƒëang n·∫Øm gi·ªØ.</li>
                </ul>
                <p><strong>Th·∫•t B·∫°i:</strong> N·∫øu Ti·∫øn ƒê·ªô c·ªßa ng∆∞∆°i r∆°i xu·ªëng m·ªëc √¢m ƒë·ªëi ngh·ªãch (-15, -20, ho·∫∑c -25), linh h·ªìn ng∆∞∆°i s·∫Ω b·ªã ng√¥i ƒë·ªÅn nu·ªët ch·ª≠ng.</p>
            </div>

            <!-- Trang 2: C∆° Ch·∫ø M·∫•u Ch·ªët (ƒê√É C·∫¨P NH·∫¨T) -->
            <div id="page-mechanics" class="rulebook-page" style="text-align: left; line-height: 1.7;">
                <h3>H√†nh ƒê·ªông & T∆∞∆°ng T√°c</h3>
                <h4>H√†nh ƒê·ªông B√≠ M·∫≠t (Giai ƒêo·∫°n Th√°m Hi·ªÉm):</h4>
                <p>M·ªói bu·ªïi s√°ng, ng∆∞∆°i ph·∫£i ch·ªçn 1 trong 3 h√†nh ƒë·ªông. M·ªói h√†nh ƒë·ªông ƒë·ªÅu c√≥ r·ªßi ro v√† ph·∫ßn th∆∞·ªüng ri√™ng:</p>
                <ul>
                    <li><strong>üìú Gi·∫£i M√£:</strong> H√†nh ƒë·ªông n√†y ƒë√≥ng g√≥p phi·∫øu v√†o phe "√Ånh S√°ng".
                        <ul>
                            <li><em>Ph·∫ßn th∆∞·ªüng:</em> 30% c∆° h·ªôi +1 Ti·∫øn ƒê·ªô, 10% c∆° h·ªôi t√¨m th·∫•y m·ªôt <strong>C·ªï V·∫≠t Th√°m Hi·ªÉm</strong>.</li>
                        </ul>
                    </li>
                    <li><strong>üí£ Ph√° Ho·∫°i:</strong> H√†nh ƒë·ªông n√†y ƒë√≥ng g√≥p phi·∫øu v√†o phe "H·ªón Lo·∫°n".
                         <ul>
                            <li><em>Ph·∫ßn th∆∞·ªüng:</em> 10% c∆° h·ªôi t√¨m th·∫•y m·ªôt <strong>C·ªï V·∫≠t H·ªón Lo·∫°n</strong>.</li>
                        </ul>
                    </li>
                    <li><strong>üëÅÔ∏è Quan S√°t:</strong> ƒê·ª©ng ngo√†i cu·ªôc, ch·ªù ƒë·ª£i th·ªùi c∆° v√† ƒë√≥ng g√≥p 1 phi·∫øu "Quan S√°t".</li>
                </ul>

                <h4>ü§ù Ph·ªëi H·ª£p:</h4>
                <p>Trong Giai ƒêo·∫°n Th√°m Hi·ªÉm, ng∆∞∆°i c√≥ th·ªÉ ƒë·ªÅ ngh·ªã Ph·ªëi H·ª£p v·ªõi ng∆∞·ªùi kh√°c. N·∫øu th√†nh c√¥ng (c√πng h√†nh ƒë·ªông), phi·∫øu c·ªßa c·∫£ nh√≥m s·∫Ω ƒë∆∞·ª£c g·ªôp l·∫°i th√†nh m·ªôt.</p>

                <h4>üî• V·∫°ch Tr·∫ßn:</h4>
                <p>V√†o Ho√†ng H√¥n, ng∆∞∆°i c√≥ th·ªÉ V·∫°ch Tr·∫ßn h√†nh ƒë·ªông c·ªßa m·ª•c ti√™u: ƒê√∫ng (Ng∆∞∆°i +2, M·ª•c ti√™u -2), Sai (Ng∆∞∆°i -2, M·ª•c ti√™u +2).</p>
            </div>

            <!-- Trang 3: Ph√°n Quy·∫øt ƒêi·ªÉm (ƒê√É C·∫¨P NH·∫¨T) -->
            <div id="page-scoring" class="rulebook-page" style="text-align: left; line-height: 1.7;">
                <h3>Ph√°n Quy·∫øt ƒêi·ªÉm Chi Ti·∫øt</h3>
                <p><i>"Ng√¥i ƒë·ªÅn ch·ªâ c√¥ng nh·∫≠n n·ªó l·ª±c c·ªßa phe c√≥ √≠t ng∆∞·ªùi h∆°n. S·ªë ƒë√¥ng th∆∞·ªùng d·∫´n ƒë·∫øn s·ª± t·ª± m√£n v√† th·∫•t b·∫°i."</i></p>
                
                <h4>Khi C√≥ Phe Th·∫Øng/Thua:</h4>
                <ul>
                    <li><strong>ƒêi·ªÅu ki·ªán:</strong> Phe c√≥ <strong>√≠t phi·∫øu h∆°n</strong> s·∫Ω th·∫Øng (Gi·∫£i M√£ vs Ph√° Ho·∫°i).</li>
                    <li>Ng∆∞·ªùi thu·ªôc phe th·∫Øng: <strong>+2 ƒëi·ªÉm</strong>.</li>
                    <li>Ng∆∞·ªùi thu·ªôc phe thua: <strong>-1 ƒëi·ªÉm</strong>.</li>
                </ul>

                <h4>Khi K·∫øt Qu·∫£ L√† H√íA:</h4>
                <p>C√°ch t√≠nh ƒëi·ªÉm s·∫Ω ph·ª• thu·ªôc v√†o s·ªë l∆∞·ª£ng ng∆∞·ªùi üëÅÔ∏è Quan S√°t (xem chi ti·∫øt trong game).</p>

                <h4>S·ªë ph·∫≠n K·∫ª Quan S√°t (üëÅÔ∏è):</h4>
                <p>S·ªë ph·∫≠n c·ªßa h·ªç ph·ª• thu·ªôc v√†o vi·ªác s·ªë l∆∞·ª£ng phi·∫øu üëÅÔ∏è c√≥ ƒë·∫°t "Ng∆∞·ª°ng" hay kh√¥ng (Ng∆∞·ª°ng = S·ªë ng∆∞·ªùi ch∆°i / 2).</p>
                <ul>
                    <li><strong>N·∫øu c√≥ √≠t Quan S√°t (< Ng∆∞·ª°ng):</strong> H·ªç theo phe th·∫Øng v√† nh·∫≠n <strong>+3 ƒëi·ªÉm</strong>.</li>
                    <li><strong>N·∫øu c√≥ nhi·ªÅu Quan S√°t (>= Ng∆∞·ª°ng):</strong> H·ªç b·ªã <strong>-1 ƒëi·ªÉm</strong>, v√† <strong>ch·ªâ phe th·∫Øng</strong> ƒë∆∞·ª£c th∆∞·ªüng th√™m <strong>+1 ƒëi·ªÉm</strong>.</li>
                </ul>
            </div>

            <!-- Trang 4 M·ªöI: C·ªï V·∫≠t -->
            <div id="page-artifacts" class="rulebook-page scrollable-page" style="text-align: left; line-height: 1.7;">
                <h3>C·ªï V·∫≠t B·ªã L√£ng Qu√™n</h3>
                <p><i>"·∫®n s√¢u trong c√°c h√†nh lang c·ªßa ng√¥i ƒë·ªÅn l√† nh·ªØng C·ªï v·∫≠t mang quy·ªÅn nƒÉng c·ªï x∆∞a. Ng∆∞∆°i c√≥ th·ªÉ t√¨nh c·ªù t√¨m th·∫•y ch√∫ng khi th·ª±c hi·ªán h√†nh ƒë·ªông Gi·∫£i M√£ ho·∫∑c Ph√° Ho·∫°i."</i></p>
                <p>C·ªï v·∫≠t ƒë∆∞·ª£c chia l√†m hai lo·∫°i, m·ªói lo·∫°i c√≥ nh·ªØng hi·ªáu ·ª©ng ri√™ng bi·ªát:</p>
                
                <h4>C·ªï V·∫≠t Th√°m Hi·ªÉm (T·ª´ üìú Gi·∫£i M√£):</h4>
                <p>Nh·ªØng v·∫≠t ph·∫©m n√†y cung c·∫•p th√¥ng tin, s·ª± b·∫£o v·ªá v√† l·ª£i th·∫ø chi·∫øn thu·∫≠t.</p>
                <div id="artifact-list-th√°m-hi·ªÉm">
                    <!-- JS s·∫Ω ƒëi·ªÅn danh s√°ch C·ªï V·∫≠t Th√°m Hi·ªÉm v√†o ƒë√¢y -->
                </div>

                <h4>C·ªï V·∫≠t H·ªón Lo·∫°n (T·ª´ üí£ Ph√° Ho·∫°i):</h4>
                <p>Nh·ªØng v·∫≠t ph·∫©m n√†y gieo r·∫Øc s·ª± h·ªón lo·∫°n, ph√° v·ª° k·∫ø ho·∫°ch v√† thao t√∫ng quy t·∫Øc tr√≤ ch∆°i.</p>
                <div id="artifact-list-h·ªón-lo·∫°n">
                     <!-- JS s·∫Ω ƒëi·ªÅn danh s√°ch C·ªï V·∫≠t H·ªón Lo·∫°n v√†o ƒë√¢y -->
                </div>
            </div>

            <!-- Trang 5: T·ªïng Quan Vai Tr√≤ -->
            <div id="page-roles-overview" class="rulebook-page scrollable-page">
                 <h3>T·ªïng Quan C√°c Linh H·ªìn</h3>
                <p><i>"ƒê√¢y l√† danh s√°ch t·∫•t c·∫£ nh·ªØng linh h·ªìn c·ªï x∆∞a c√≥ th·ªÉ vang v·ªçng trong ng√¥i ƒë·ªÅn."</i></p>
                <div id="all-roles-list-container"></div>
            </div>
            
            <!-- Trang 6: T·ªïng Quan Ti·∫øng V·ªçng -->
            <div id="page-decrees-overview" class="rulebook-page scrollable-page">
                <h3>T·ªïng Quan C√°c Ti·∫øng V·ªçng</h3>
                <p><i>"Ng√¥i ƒë·ªÅn c√≥ th·ªÉ b·∫ª cong th·ª±c t·∫°i b·∫±ng nh·ªØng lu·∫≠t l·ªá c·ªï x∆∞a n√†y."</i></p>
                <div id="all-decrees-list-container"></div>
            </div>
        </div>
    </div>
</template>
</body>
</html>